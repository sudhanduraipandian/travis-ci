language: python
python:
- '3.6'

services:
- docker
- mysql

addons:
  mariadb: '10.2'

env:
  global:
  - secure: m60wLQKswtwoB31n21Zcqg0+VTICfSnjowLeB4B5Dwi+Fnx4qYPzyvl0Elus1EDGSMRij/UHVS4PjfwXyXpqdfBGC5RjLJFgbEuCCZFNeKGNbJf5tY4zFJXpeReT8cAATnsdAHxMsWb0WowYq8UDPX58jQehcoqRPnv2gzUcm0EHLGrPe/W4vpS0B8BlFiEnxkgCikQgOK5wbVWF6HsEYwYs9IK3KPiIIy2IL/tJOUJ/PnDtWpxAcdmLjkHlFL7sDJFldNkgVq75i7PL4cPLs7NMBNGbwn7gMffmrr8gt/hZIGGvyuAM50iji2TjzqngF8DofxGY0xmA34/z5Ak7lw9EIiNqOZxGCz5M46OjlNdxgIBS4wOL81HiMvcQD9RRDkmxwdrEjDVRgTENejMtGgDeoLf3FMCXQ7DIPZBmbRWJj49ff8Z6lEzmXTcDuz2DDznR0Ij4o8i/A8obndWofUQCY+ZgKjG7J6l/66Q4Sn8P3NkSfQpcI0TOmWJ3wc/mbBBoQSMn1ViECXbcsFJi7tPuPrrJi/457o9U0MiQmNdYkh8Lv/e2MrVdVqFTnYLeqQ1hAq8rxYMoPQMjlGZCQ+k2yuR6WqOx7hbhch9dr9l+P+KDlsqQzipu6O19K57Vai+Zf/K0v5Ld1/mWy0xZBSXBR4pW2aRxe5XDzNH7yGM=
  - secure: KSh8aQEi/hTgiZsiqxsUUq/UCgor8YkYtF/RHwW1mWj3jLrXFeVZaKk5CAaXP5quks2ewNKy7mtbNTbjdZwZK3Z1ijee+PeKuZvUfwG57eXzi9bYj8hHWSowZ2OdqjRXrzilSt56nJyj58IzyIwPBB6L+gjL+Ad27qSYWEqft3eBYZsHugAcU1sB4et9C2dC+yEVGRDx+fRgHyw2qgb6WLBH3x9Akfid40zbjshJUVmZ8j5eoIsodJwcJlxrd4lglZY8DdYF/VnQQ3hWytkVPQx59dPq+tQ1G+txZuUt4YxlPnr7L/1+dEfmY/RArArYLTp39EXeb6pDs5qfKneEUbSsBXkhRe5SiuRqf3JsqTNKclPqhArp7sPWqoZJOQAYKBOsZ2bPP0MvpXZnGUgMNyMzI3ZkEo2CKRVkkaynpmFa5UUiZBM/boV/izc+QncoVqvHlavdjLp08S/i9cA+bqBqVdRzY85a9m2LrS7SM23bSdW21lt4ly4gERsoiE6iHzkstm4xqIHFY9CBnAVGf1ca3Ty58UH+rWe85yHbSMs0KhFua1yfC4ekB0FHNTxqUliuBu410wxeQVvvAC/t/FEG3HZ2Fl0qjb4u6GDovVbYeKsbk3qd1UJvmYNtKHquZOZq9hkt4h6RnTAlA1dQdsnZ0jFnWGw1GCOOvahzRO8=
  # Development Setting
  - secure: 2NLIzqg5hCGw5J8yPLDGB0u1nfmGBN0WSkg1cnkniaUblHZ1TFs86Ou69dk86l75Yoof/nlUju3vEFBnXoBUVQIyHMh0WwyKnglY2w55wRlVDcBDDFnVAg8d0aOezGs3ghUx+4TYnTRxNzSc32AEBbodlkUYeXiUEgQyr/63DhO8LrheDjtWALSDmtM4FQkWL6llo0E5NON6So5BxZBeY04dh+mwvX5+OBC6En1+6f6dCgjWKGJVTk0QOxA9I/OlgfOm/FNQi9fzKkYQlathSgPipzAlLFJ+a8/r9DRZaHd5i2HEWRmkLVJebS1ot2ly5yQ2K+jy9drVC3kEjE/jDvsx0WhcxSRqaw36PIeMpQIj9gxFNNMRHDV96rh/uE4shsjVhHbjs31RRjwFCMtW87WlHF9vp4u1d3N2H7PaXj1rxaQWGMAhld0+dHsw0a2LERSBrFCL5X3Nh28LdypBwzHYm6QZ0/fpxWGjywVpBdBfzP+V05qLyYSPOvoxlNN0F4c0h3IP7Mk7/NqnXFjrYh3b2wq2H4UtRQHMECn2SDh3WNFyvPxb64U5EXzMki0cMtjbsVEWKFLnfCdkFCeTZXSmAVGp/SKtu2dl5EjrQ7yvE9e2b7Nh9LE8qVjHObbSnzv3AjsHj6PN9oF4PixxvcvPZMZuCt6lLF6GNfraYHA=
  - secure: 4TGb/w371vLpf0jvrWIoZtHEnYk6/2MBSiWyB++6IZ5wD/y78tkOA6nTmsZ5zveACXeHzkoO6j/SVV0vdgg7MIkkO0K5ZWwvb+AXV/k5TRI2HPQRnglnBKkrGGB8IZ6YqXG8aLAVMw7P4Tj88zAnvxgC0qYR+V9CIHqYFgKCnbLfGn9BLYXYiSX9f7MFPIMV6i47Owxvn2s1bdrb+94XMK1BMldRqg123ftJeW9tN6ufBj2lkhL3yw0RW1L45rUT6m1RAXpxdtoUqEq4c4aJWS7gKnjNcQg1jx6H0xRBbuAoMrfgiH0USvgYZJ8JuB4y0ez9p/3JNL5GZfmXrX56EkUcggO+0Q185UdApWLS0zLYkLEMuAwYk1FiRYQ3zRWUB15HVjyySpZJksrt1YWFR2/U0ABCkZNh4s0OXVfyzTLHaNcvk+t8CnNGzIGeI/apAF6EcV1sNat7rv+E/NaQwPmMjKWzVXwErvqQsYtWyFWV8/zOjwVQ5sWne1+C3MxNzB9J/FRhTlc1eAg203X45mPBV4BT5+737YlG9Ls/lmb54JO0Y19H7PZf9KSK5qVoGdzUTLGvISTYMsoJlv5cnSFLsy2PhPAsqFyaqxL8IMYAxUHob7ygQYrZ9IQLkcb8qfuFI7QUSQpKBBm2nM+d+sBeyNA1cBFO3/0INxs/nUk=
  - secure: olEZEtqkD7YxjQHfPxvw5YSPKmXIDwi9AwqSgQskyihNLTzxfNqg2YoJOc/eX45i9ziHm0wtuI9EkZGA4mzujIk/43vQaNmzNLyVRopyjW+/LNdxKWKMDeDeSbZ37tH4XmBiWgvNCuKzCZRiOVMAxCGeOz13MvjVDOSlEl7NInBxMvYsMMh9JZRxcVBRHJAfsevSG/I3GDgmcjqqz89uGhI8S8Y31zYUOdvKA2zbHq8JkdkHySVHBJJ6rR7VcbV3M3x1ArSjWtEPYMn3hWGKFsRLyy5Ua50wWz9VbCqUGlA8w+ChuP78GZ2r9XcbwujfFcg+JZT9JLPbAHmXbkkqbBMbQH9jb0bdM3PmoJFJkj8mI/WizinUwOg7U1e4or15w3eaMVXyU4x50991pZmreQ1lXqaPYZoadR4H4N+KsnDa2zcAVZGnTDVJcBxt9mksHukdjVxD6grKwRlSXXqGOYq9Wq/mZk7ZSDVA3nJLMZy8G9LDjLBOo6dQlo55OaEcJrAsDFBP0af40porfAamI1X99b2Kzs5rp/Q7pI3POEuQoUavxCC55/FSgjkL6jNp4LOsrYVgymymrPZ9p13JQilUK7JMPVq/F/mByPAdoEJbq8QG4p1DyPwwYfA7hygs8qpMXm3sBGhhjukOUQtZGFqs/c5ft4xGYNbwBGL30eo=

  # Staging Setting
  - secure: AzfF2G4fdJRNUerY2ogzlYuZtLoISaUvydGV8HXHbwcZqOMuwJ90//BEzX/iKxVxNkEFY53Lepef8HetQpJHmzL21Y2qiGC+o+18R0dCz3hMBjfta1v1zRPhUwruOahiuHNjqMAv2Zg0q1yezAWkwrnwSYLDq5GsbZ5xWyg9g8m4/hRKOgoBczcfz87U5QGgC9K+GQ1mLYRFHx9tUQfIuiVorFg50GZZn2/J65V37E3U1WPnlyi0AAu6golcH2xTQaJJAZQwMSBkKVOfStDD6oQ9Lc8K8WyS4dQSrlHbSSyjc/4+ZU/4isYz/R0v50pD5k0FRp48PUhO3M+Nx1+Ji/0UuHsTxQqYQs6fQ9IxuwLB4tJzH10j8yrggUxYHG8n463WAjWaSoEerlSNlHR1ZbGHYqm9cNUYHhUXMWaA1GsIgePQZ3/nz+zO9tHXDKEbsDSH2aIYWprGJl6ckJkAYzrWM5U82U7HuMhuS4gnvTwckeaw1SBDHj5bht67xFuuAC7jPuQ1rb7j6XGBDpPjnY/zf//qXNobYVsDKvbnv2QzJCP6Wl2QuykwG48+a8T2Hv89gf+wTMQQor7/ezeix7nrqe/FvbLhZ84GlXVWk2I2DpfmhKK6mRFdWMkn8WIdR4Havg1+zYnMNk0jSZFu5tzF6gn3BcVBAILnZACSyns=
  - secure: FMVFUH2WMH12z5EoyWJ2DAmEIkKGKBXSFXzStMRJLI+Wmyw7rZc6mfxljoinOlAuepsNBLQYnNgr7dUiTkdm5TQEPg86sQWpLPu3roW6MLg2bd3OXH7Oy6PWQlbJM+qQn6+kyz1dxfr+wd+PnwQ6bihXVdcDGemo6JbQQF7IEBFxOGQBXFHzRkxTLzxHx0MuCAVzAQ58EfQUgruWEMt5R06UBRzovVS2WTyw/xqiUAmItzdNBUFwc+nZzPWKKMrT882RSeNj6ZqvVMmIj0a9ziMIPXdRiq7z4og9Qwa6a/xqPSuIqFBFw9E4CdCdEKSpGet5frx41m4YCIC09w/XT7lz0ba5oj4wHxvgmVHJmTT5iI4nxOuEWPKuTaNUDxhwvihOxqvyV7xK5ibgUas6fpk4WzWwidie4AUEwYveoM4aaG8Tgt6aJQcunTSYva2Fmp+Ewi/JSpvzEvoXqQZPCNfwVNLjdLY44oJWGQi0ksm/Y0dA5tnbZkKo8J67iaJB+rWkKuNj42d0Gkqvkru/Dzu8B7cKPpmf+Pq50Oe+iA8/QNvg6vH9YXeH958Z3AtuEi9VfcNBXfjbw/bktDGoFylwbqWKAv64yZjnRJI98naoc4mPpF6KGrNj80ARnzWEJ4vxvRKs6IH1VUfpcMuQ1IEED1BasiFvfVerIkZvlKA=
  - secure: Fxj8MtZdRrhmOIIhSWoOPlMPFFVU8t+yKXFZOyjlo21ZhHM8oWKHWv4pW6PF8wxDGllhRNLTQ3GFWhy5XH0m7U7DppoV1BQPoksHpWQO5YUP441Avez5k7s3u97rWj4VJLPhAZvHtlTTRgE7sLk5U1WY2OSilBz18eniAyeWU1SlansNjVJIfK6Z8ctc19asyWiDe4oIMFOZ/C9lt/AbcuRqQ7FU47eSpQvimMWnNhmxByWitT5cPQQmmhpEZc5vH+oTPQ1sHX/DyZT7RHgwBPVAQF3w2jgSH2k5sYuzECgK+/pKI+1Si8BG1eytxzS6Ek1/vO0PkwApoKOv3gExqUHWkkQrANJzZpcZTz5D24y8XThGeN7XTo7ce0D92syFFMwg31DHqmr8aDTBONHVTzBv2fHEk4UAE96CqSRRusKWo8O0pcdjKH7ntOfWWAzwUqx6ybJ/wKO3/gH2D/3hgl/xydL2cvRkwe4+LP2Ogz/bsarwoIzEEpYjjE4SEhC8+qEAhKR81uzjFWMn+b2GJWztSuNDX6BZLt5FoFcV8wrPp96EPHbjfK2jlZ0W+IbFo8dahsJwx4Dtx/qDtyovuoFS1Vz6Z7hEg7haXpELlvKviqzvBIW8s6ixR5mC4RlsQqcuX7JBhP746QUyyw8ZnrTAKFkPxBRJnVfIJFmWJxY=

  # Production Setting
  - secure: LicpJlyyyeKkNAdo1b9qQuFudAtenvej+4EkINRg7dm+YnMXq5CKe4eYh800eseveUMPo2DYnEf5dbAsk7LEHsx4qfCZ3aOl3SPGFiLqxbaZ09nbJdHZdN9IK4vtQpCY2Wzd0FiUq05D8nBPtE/ijI1HfVwpEUbI2jUHwIz8MSjazz9Wqq/QP/hKMiguEFLJSFd5Hme0OuLmxasW71qzXB4ENp2pRrd3l66uAz30QaslvOcjcZAyQ5LEWGtZAt04VO38xumk/6H4uKYnfGp0lB6bYXEI3CSDEzoS96GUrrwJj7E/ceTqTkq5tU4GI5qHs0OSWgAiNtowCy/2qWff/gMbvRxIuJdaoKMNyKssqa0GrABrB5Ql3+xBvG+2W+8nXveSPIBbZBAk3jsB9a0rw/RzOKuz5p0ciB453td8/UXkyEYMauyCJX1rHBDMyhd71OLSPM1IDm6tjjofRd2bKFMYL1Qr2ZbbLv3myXP/+oxvxcd6ay9W6niqOvphAk4TVsGMEoL0iCxjfMaxV1CJYcupq83J8TmlmDsNBCtAfzHuinMrUYWa/eDa9iedskqsZEgk/dg749YER4cc69E1t8dLvUkVhxIhz2RE/4/e3leCQLbTkkJZz1EOTBDvibBPq5tyOye2GgoNbgZvk/SEGtVoXO3T+CTgzKCMx8eCz6A=
  - secure: BGZ2kcwTY94+FWE+ZQfvNBOj62qZPmfsny889N5qCIlek1xq4ZKyj5sUc0XKrpWfSrA9suZGyA++CcLGQbD4CaXnZMnq7oDNjEWEnGxClTTvUGPteWNlrlZE/3ecNx0e8hZOJ7Yy+RYDpuW6ZszB7FlEQK5x0Wn6krFuixZ43vNENnTq5FOyK7JQ90eMrMH1PMSuvxNTKEht5tiXx/fPbhdXxIqsBYbGDEBlF36dA5E0p3JbsxYeczTI3iLZHQKQswbz6Dvn0lmQbINCMwJrv8i80MUqpFfoe5OftnVHftOnAxWRby7SnKU29lCk2XuFHM4LoCplD+cwC3Z7ZavKVUikyCxjXr/iVchnI74Kwruq+jLDtoNQAlSTHb4CQbH37g6RoUB1gqEoWl4OjJouUU2FTx+KeiC8eAcaTbAFyQ2TnNInqQRPFJLRmMrbofEC+DcFrmvn7Hj2l4XfBRGk3tw23kSHhHBLpHDbe6lP6s0Gj/j51kzLNfe2UZcfnPUc0MlXVkizl2MYZaRN82Wa3F59Ihc5isjkblnEU688oOk88Bi7MomAfXZp5hJBPo4Kn16ZXFe2NBQ46zQDZiRbEWKLZwY/6O0eQMVK/KS13kpMq/YaPBdSXaTx2CZ6AIZ7iAg3v+6i1hl6Gw6ctI9h0+tFGJK22ScTgzRPkwzarKU=
  - secure: aalbrB9FpFf+/21u73l6LgI2RatyZnlYpZ1u0rgocoZd1ZqvoUO7HZ0FS356HkAkqM0YU/JOaOZBPVqRoMUGojTNsd0rPKCgBaqjSw2JaQ/IUlrYZ4qj/BcUMU82DKdyr2/4TDBKq5JofQxqxVcuR8LZOoIDoP+NYmlARff+2cia2KCUi4ua34/i4xlm8gU/kV1LocLelqim6+5WOyyoaTW9IY0qdtJcNQzp6p9vBI/5eUAkNlwSXKjLNTy9NPkrzL1OSkYWizzDE8AnVKFStmCzMK9ZEYcqR6UwPUishOlt8uFzvjh6+bhXw2W8P1HZSQD79JXLsO2xwMtondm+3cd4z9KzkgE8hFiRb7moNMFOexip0b6Edko8MJCmcBySNKruEtAYgRtfzuwuwNoKKcSITFplPVwkGuZtuP2LYjpZrJ5fLQ5J2fVnNdDoQYU1TRLczdRUr4I2oAAaR5PZR2mh0LNJvSykhAz3wit0ARLLan+BhSsD6XVCGO/GoBV19/vIgHpjiYkuNbNfqJyJ6nNr3YnlZusbFhuzm/G4xiLEGInpkAPft+0X+EvNqdzvPv3aSpsud7pB9AVSEkXPe3p6Ymp6cHvzEES5zKhgtHOqkgspiYYXy8/5gOA1or+8HL9yLcygjHtTiwU17WXDKf6B6GgwSJGseUYUsS+YcVg=

install:
- make global-python-package-install-development

before_script:
- make settings
- mysql -u root -e "use mysql; UPDATE user SET password=password('root') WHERE user='root'; flush privileges;"

script:
- make lint
- make test
- make check-deprecated

before_deploy:
- pip3 install awscli docker-compose
- sudo curl -o /usr/local/bin/ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- sudo chmod +x /usr/local/bin/ecs-cli

deploy:
# Deploy development
  - provider: script
    script: bash docs/scripts/deploy.sh development
    on:
      branch: master

# Deploy staging
  - provider: script
    script: bash docs/scripts/deploy.sh staging
    on:
      branch: master

# Deploy production
  - provider: script
    script: bash docs/scripts/deploy.sh production
    on:
      tags: true
